<template>
    <div class="comp_container">
        <h2 class="h2s" >Skills test</h2>
 
        <count-down-timer 
        ref = "countdown"
        v-if ="!test_time_expired"
        :deadline="five_minutes_deadline"
        >
        </count-down-timer>



        <test-question
        v-if ="!test_time_expired"
        v-for = "skill in skills"
        :key = "skill.id"
        :question.sync="skill"
        >

        </test-question>
            
        <b-button
        v-if ="!test_time_expired"
         class="btn btn-info btn-secondary actionbtn" @click="submitHandler()">
            Submit 
        </b-button>

        <p 
        v-if ="test_time_expired && !results_came_in"
        >
        Time expired. Wait for results.
        </p>

        <div 
        v-if="results_came_in"
        class="comp_container"
        >
            <!-- TODO: izbaci hardkod -->
            <h2 class="h2s">Results</h2>

            <p>First answer: <span><code>true</code></span></p>
            
            <p>Second answer: <span><code>false</code></span></p>
            
            <p>Third answer: <span><code>false</code></span></p>

            <p>Your rating is : <span><code>33%</code></span></p>
        </div>

    </div>
</template>

<script>
import SkillsTestAPI from "../../../services/api/pentester_api/SkillsTest.api";
import skillsHardcode from "./skillstest.hardcode";
import TestQuestion from "./Question.vue";
import CountDownTimer from "./CountdownTimer.vue";
import eventBus from "../../../utils/eventBus";

// TODO: izbaci testove
// TODO: dodaj pitanja
// TODO: dodaj api za odgovore.

export default {
  components: {
    TestQuestion,
    CountDownTimer
  },
  created() {
    //this.skills = SkillsTestAPI.getSkillsTest()

    //BUG WAS HEREEE
    //hh vs HH is diff...

    this.five_minutes_deadline = moment()
      .add(1, "minutes")
      .format("YYYY-MM-DD HH:mm:ss");

    this.five_minutes_deadline = new String(this.five_minutes_deadline);

    this.quest_selected = skillsHardcode.map(skill => {
      return { ...skill, selected: null };
    });

    eventBus.$on("time_expired", res => {
      this.test_time_expired = res;

      //TEST:
      window.setTimeout(() => {
        this.results_came_in = true;
      }, 1000);
    });

    this.skills = this.quest_selected;
  },
  watch: {},
  methods: {
    submitHandler() {
      this.test_time_expired = true;

      let answers = this.quest_selected.map(el => el.selected);

      //TEST:
      window.setTimeout(() => {
        this.results_came_in = true;
      }, 1000);

      // SkillsTestAPI.checkAnswers(answers).then((response)=>{
      // this.results_came_in = true;
      // });
    }
  },
  data() {
    return {
      skills: null,
      quest_selected: null,
      five_minutes_deadline: null,
      test_time_expired: false,
      results_came_in: false
    };
  }
};
</script>

<style scoped>
</style>
