<template>
<div v-cloak>
    
     <!-- <h2 class="h2_profile">Profile</h2> -->
    <div class="profile">
      <!-- TODO: add changeable  -->
      <!-- <span v-if="isChangeableAvatar">
        <icon name="bandcamp">
        </icon>
      </span> -->

      <div 
      :class="{
        avatar:true
      }" 
      style="cursor:pointer;"
      @click="goToChangeAvatar()"
      >
        <a>
          <img :src="avatar_url">
        </a>
        
      </div>
      
      
      <span class="header_text">
          <p>
            {{info.name}} {{info.username}}
          </p>
          
          <star-rating
          :increment="0.5"
          :class =  "{'user_stars':true}"
          :active-color = "'#D80032'"
          :star-size = "20"
          :read-only = "true"
          :rating="stars"
          :show-rating = "false"
          >
          
          </star-rating>
      </span>
    </div>
    
    

      <div class="main_profile_container">
        <!-- SECTION FOR ICONS  -->
        <div class="flex_data_first">
          <profile-data-wrapper
          goToRoute = "myjobs_pentester"
          >
            <icon 
            style="fill:#D80032;"
            slot="data_icon" 
            name="tasks">
            </icon>

            <div slot="header_desc" class="ps">
              <p>All Jobs</p>
            </div>
            
            <div slot="quantity">
              <p>{{jobNum}}</p>
            </div>

          </profile-data-wrapper> 
        </div>


        <div class="flex_data_first">
          <profile-data-wrapper
          goToRoute = "startedjobs_pentester"
          >
            <icon 
            style="fill:#D80032;"
            slot="data_icon" 
            name="hourglass-start">
            </icon>

            <div slot="header_desc" class="ps">
              <p>Started Jobs</p>
            </div>
            
            <div slot="quantity">
              <p>{{startJobNum}}</p>
            </div>

          </profile-data-wrapper> 
        </div>

        <div class="flex_data_first">
          <profile-data-wrapper
          goToRoute = "finjobs_pentester"
          >
            <icon 
            style="fill:#D80032;"
            slot="data_icon" 
            name="flag-checkered">
            </icon>

            <div slot="header_desc" class="ps">
              <p>Finished Jobs</p>
            </div>
            
            <div slot="quantity">
              <p>{{finishedJobNum}}</p>
            </div>

          </profile-data-wrapper> 
        </div>

    </div>

    <div>
      
      <div class="personal_info">
        <h2 class="h2s">Jobs finished</h2>
        
        <v-client-table
        :data='all_info'
        :columns='columns1'
        :options='options'
        >
        <a  slot="rating" 
        slot-scope="props"
        class="centered"
        >
            <star-rating
            :star-size = "rating_options.size"
            :read-only = "rating_options.read_only"
            :rating="props.row.rating"
            :show-rating = "rating_options.show_rating"
            >
              
            </star-rating>

        </a>

        </v-client-table >

        </div>
    </div>
  

</div>


</template>


<script>
import ProfileDataWrapper from "../../UserChildren/Dashboard/ProfileDataWrapper.vue";

import StarRating from "vue-star-rating";

import AllInfo from "../../../../services/api/pentester_api/AllInfo.api";
import eventBus from "./../../../../utils/eventBus";

import Icon from "vue-awesome/components/Icon";
import { mapGetters } from "vuex";

import "vue-awesome/icons/hourglass-start";
import "vue-awesome/icons/flag-checkered";
import "vue-awesome/icons/tasks";
import "vue-awesome/icons/globe";

//TODO: napuni info
export default {
  computed: {
    ...mapGetters({
      jobNum: "returnJobsNumber",
      finishedJobNum: "returnFinishedJobsNumber",
      startJobNum: "returnStartedJobsNumber",
      avatar_url: "returnAvatar",
      stars : "returnRating"
    })
  },
  components: {
    StarRating,
    Icon,
    ProfileDataWrapper
  },
  methods: {
    goToChangeAvatar() {
      eventBus.$emit("getToAvatarPent", true);
      this.$router.push({ name: "setup_pent" });
    }
  },
  created() {
    this.info.name = this.$store.getters.returnUsername;
    this.tokens = this.$store.getters.returnTokens;
    
    //TODO: promeni za rating
    this.info.rating = 3;

    // zapoceto, treba se renderuje cv i 
    AllInfo.getAllInfo().then(resp => {
        console.log("resolved obj ", resp);

        this.all_info = resp;
        
        // resp.projects.forEach(project => {
        //   this.projects.push({
        //     title: job_info.title,
        //     date_from: job_info.date_from,
        //     date_to: job_info.date_to,
        //     description: job_info.description,
        //     //job_info
        //   });
        // });
      
      // console.log(this.all_info);
    });
  },
  data() {
    return {
      rating_options: {
        read_only: true,
        size: 20,
        show_rating: false
      },
      columns1: ["client_name","rating", "review", "price"],
      info: {},
       options: {
        columnsClasses: {
        },
        filterByColumn: true,
        headings: {
          client_name: "Client"
        },
        filterable: ["title", "startingPrice"],
        pagination: {
          dropdown: true,
          nav: "scroll"
        }
      },
      all_info: [],
      jobs_done: [],
      cv: null,
      projects:[],
    };
  }
};
</script>

<style scoped>
.flex_data_first {
  flex: 1;
}

.main_profile_container {
  display: flex;
  flex-direction: row;
  margin-top: 10%;
}

.icons_hacker {
  fill: "#D80032";
}

.dates {
  color: white;
  display: flex;
  flex-direction: row;
  width: 50%;
  margin: 0 auto;
}
.dates p {
  flex: 0.7;
}
.header_text * {
  margin: 0;
}
.header_text {
  width: 50%;
  font-weight: bold;
  color: white;
  margin-left: 2%;
  display: flex;
  flex-direction: column;
}

.user_stars {
  height: fit-content;
}

.profile {
  display: flex;
  flex-direction: row;
}
.avatar img {
  border-radius: 50%;
  width: 7vw;
  box-shadow: 0px 0px 0px 8px #fff;
}

.personal_info
{
  margin-top:5%;
}

/* .proj_container { 
  margin-top: 2%;
  background-color: $bg-project-color;
  margin-bottom: 20px;
  text-align: center;
  margin-left: auto;
  margin-right: auto;
  box-shadow: rgba(0, 6, 16, 0.31) 3px 3px 7px 2px;
  padding: 5%;
}*/

.user_stars >>> polygon {
  stroke: transparent !important;
}
</style>
