<template>
  <div id="user_comps" ref="pentester">
      <div class="nav_btns">
          
        <b-button 
        ref =  "info_btn"
        v-b-tooltip.hover.right="'Info'"
        class="btn btn-hacker" @click="hideShowInfo">
          <icon name="info" :width="icon_fix_width" ></icon>
        </b-button>
        
        <b-button v-b-tooltip.hover.right="'Messages'" class="btn btn-hacker"
        :to="messages_url">
          <icon name="comment"  :width="icon_fix_width"></icon>
        </b-button>
        
        <b-button v-b-tooltip.hover.right="'Profile'" class="btn btn-hacker"
        :to="profile_url">
          <icon name="user" :width="icon_fix_width"></icon>
        </b-button>
        
         <b-button v-b-tooltip.hover.right="'Setup'" class="btn btn-hacker"
        :to="setup_url">
          <icon name="wrench" :width="icon_fix_width"></icon>
        </b-button>


      </div>

      <transition  name="flip" mode="in-out">
        <pentester-info 
        :textinside = "textinside"
        :title = "title"
        v-show="isVisibleUserInfo" >
        </pentester-info>
      </transition>


    <!-- control panel -->

      <b-nav class="d-flex justify-content-center hacker_nav_main"  pills>
        
        <b-nav-item active-class ="active_item_hacker" :to="'/pentester/'+user_id+'/alljobs'">My Jobs</b-nav-item>
       
        <b-nav-item active-class ="active_item_hacker" :to="'/pentester/'+user_id+'/findjobs'">Find Jobs</b-nav-item>
        
        
        <b-nav-item active-class ="active_item_hacker" :to="'/pentester/'+user_id+'/cvpost'">Cv Post</b-nav-item>
        
        <b-nav-item active-class ="active_item_hacker" :to="'/pentester/'+user_id+'/portfoliopost'">Post Portfolio</b-nav-item>
        
        <b-nav-item active-class ="active_item_hacker" :to="'/pentester/' + user_id +'/skillstest'">Skills Test</b-nav-item>

      </b-nav>
      
      <transition name="main_user">
        <router-view>
        </router-view>
      </transition>


  </div>

</template>

<script>
import PentesterInfo from "../PentesterChildren/PentParts/PentInfo.vue";

import Icon from "vue-awesome/components/Icon";
import "vue-awesome/icons/info";
import "vue-awesome/icons/archive";

import AllJobsTxt from "./Data/all_jobs.txt";
import CvPostTxt from "./Data/cv_post.txt";
import PostPortfolioTxt from "./Data/post_portfolio.txt";
import SkillsTxt from "./Data/skills_test.txt";
import MessagesTxt from "./Data/messages.txt";
import SearchTxt from "./Data/search.txt";
import SetupTxt from "./Data/setup.txt";
import DataTxt from "./Data/data.txt";

export default {
  destroyed() {
    clearInterval(this.int1);
  },
  mixins: [],
  mounted() {
    this.user_id = this.$store.getters.returnId;
    this.user_role = this.$store.getters.returnRole;

    this.messages_url = `/${this.user_role}/${this.user_id}/dashboard/messages`;
    this.profile_url = `/${this.user_role}/${this.user_id}/dashboard/profile`;
    this.setup_url = `/${this.user_role}/${this.user_id}/dashboard/setup`;

    this.helper();
  },
  watch: {
    route: function() {
      let txt_info = _.find(this.collection_txts, obj => {
        if (obj) return obj.route === this.route;
      });

      if (txt_info) {
        this.textinside = txt_info.textinside;
        this.title = txt_info.title;
      }
    }
  },
  components: {
    Icon,
    PentesterInfo
  },
  methods: {
    //Updates route to be watched by watcher and
    // compute the text to show .
    helper() {
      this.int1 = window.setInterval(() => {
        let root = this.$store.getters.returnRoute;
        let ind = root.lastIndexOf("/");
        root = root.slice(ind, root.length);
        this.route = root;
      }, 1);
    },
    hideShowInfo() {
      this.isVisibleUserInfo = !this.isVisibleUserInfo;
    }
  },
  data() {
    return {
      messages_url: "",
      profile_url: "",
      setup_url: "",

      //width fixes
      icon_fix_width: 57,

      user_id: "",
      textinside: "",
      title: "",
      int1: null,
      route: "",
      collection_txts: [
        {
          route: "/alljobs",
          textinside: AllJobsTxt.textinside,
          title: AllJobsTxt.title
        },
        {
          route: "/cvpost",
          textinside: CvPostTxt.textinside,
          title: CvPostTxt.title
        },
        {
          route: "/portfoliopost",
          textinside: PostPortfolioTxt.textinside,
          title: PostPortfolioTxt.title
        },
        {
          route: "/skillstest",
          textinside: SkillsTxt.textinside,
          title: SkillsTxt.title
        },
        ,
        {
          route: "/data",
          textinside: DataTxt.textinside,
          title: DataTxt.title
        },
        {
          route: "/search",
          textinside: SearchTxt.textinside,
          title: SearchTxt.title
        },
        {
          route: "/messages",
          textinside: MessagesTxt.textinside,
          title: MessagesTxt.title
        },
        {
          route: "/setup",
          textinside: SetupTxt.textinside,
          title: SetupTxt.title
        }
      ],

      isVisibleUserInfo: false
    };
  }
};
</script>

<style scoped>
.nav_btns {
  position: absolute;
  display: flex;
  flex-direction: column;
  width: 3%;
}

.nav_btns svg {
  vertical-align: middle;
}

.nav_btns button {
  margin-bottom: 25%;
}
.nav_btns a {
  margin-bottom: 25%;
}
.active_item {
  color: white !important;
  background-color: #007effe3 !important;
  border-radius: 0 !important;
}

.user_nav {
  margin-bottom: 20px;
}
#user_comps {
  min-height: 90vh;
}
</style>
