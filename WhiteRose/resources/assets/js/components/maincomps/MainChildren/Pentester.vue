<template>
  <div id="user_comps">
      <div id="btns_nav">

      <b-button 
      class="btn btn-info btn-secondary" 
      @click="hideShowInfo">
        <icon name="info" ></icon>
      </b-button>

      <b-button 
      class="btn btn-info btn-secondary" 
      :to="'/pentester/'+user_id+'/dashboard/setup'">
        <icon name="archive" ></icon>
      </b-button>

      
      </div>

      <transition  name="flip" mode="in-out">
        <pentester-info 
        :textinside = "textinside"
        :title = "title"
        v-show="isVisibleUserInfo" >
        </pentester-info>
      </transition>


    <!-- control panel -->

      <b-nav class="d-flex justify-content-center user_nav"  pills>
        
        <b-nav-item :to="'/pentester/'+user_id+'/alljobs'">All Jobs</b-nav-item>
        
        <b-nav-item :to="'/pentester/'+user_id+'/cvpost'">Cv Post</b-nav-item>
        
        <b-nav-item :to="'/pentester/'+user_id+'/portfoliopost'">Post Portfolio</b-nav-item>
        
        <b-nav-item :to="'/pentester/' + user_id +'/skillstest'">Skills Test</b-nav-item>

      </b-nav>
      
      <!-- <transition name="fade"> -->
        <router-view>
        </router-view>
      <!-- </transition> -->


  </div>

</template>

<script>
import PentesterInfo from "../PentesterChildren/PentParts/PentInfo.vue";

import Icon from "vue-awesome/components/Icon";
import "vue-awesome/icons/info";
import "vue-awesome/icons/archive";




import AllJobsTxt from "./Data/all_jobs.txt";
import CvPostTxt from "./Data/cv_post.txt";
import PostPortfolioTxt from "./Data/post_portfolio.txt";
import SkillsTxt from "./Data/skills_test.txt";
import MessagesTxt from "./Data/messages.txt";
import SearchTxt from "./Data/search.txt";
import SetupTxt from "./Data/setup.txt";
import DataTxt from "./Data/data.txt";

export default {
  destroyed () {
    clearInterval(this.int1);
  },
  mixins: [],
  mounted() {
    this.user_id = this.$store.getters.returnId;
    this.helper();
  },
  watch : {
    route : function(){
      let txt_info = _.find(this.collection_txts, obj => {
        if(obj)
          return obj.route === this.route;
        
      });

      if (txt_info) {
        this.textinside = txt_info.textinside;
        this.title = txt_info.title;
      }
    }
  },
  components: {
    Icon,
    PentesterInfo
  },
  methods: {
    //Updates route to be watched by watcher and
    // compute the text to show .
    helper() {
      this.int1 = window.setInterval(() => {
        
        let root = this.$store.getters.returnRoute;
        let ind = root.lastIndexOf("/");
        root = root.slice(ind, root.length);
        this.route = root;

      }, 1);
    },
    hideShowInfo() {
      this.isVisibleUserInfo = !this.isVisibleUserInfo;
    }
  },
  data() {
    return {
      user_id : '',
      textinside : '',
      title : '',
      int1: null,
      route: '',
      collection_txts: [
        {
          route: "/alljobs",
          textinside: AllJobsTxt.textinside,
          title: AllJobsTxt.title
        },
        {
          route: "/cvpost",
          textinside: CvPostTxt.textinside,
          title: CvPostTxt.title
        },
        {
          route: "/portfoliopost",
          textinside: PostPortfolioTxt.textinside,
          title: PostPortfolioTxt.title
        },
        {
          route: "/skillstest",
          textinside: SkillsTxt.textinside,
          title: SkillsTxt.title
        },
        ,
        {
          route: "/data",
          textinside: DataTxt.textinside,
          title: DataTxt.title
        },
        {
          route: "/search",
          textinside: SearchTxt.textinside,
          title: SearchTxt.title
        },
        {
          route: "/messages",
          textinside: MessagesTxt.textinside,
          title: MessagesTxt.title
        },
        {
          route: "/setup",
          textinside: SetupTxt.textinside,
          title: SetupTxt.title
        }
      ],

      isVisibleUserInfo: false
    }
  }
};
</script>

<style scoped>
#btns_nav
{
  position: absolute;
  left: 2%;
  display: flex;
  flex-direction: column;
}
#btns_nav button
{
  margin-bottom: 34%;
}
.user_nav {
  margin-bottom: 20px;
}
#user_comps {
  min-height: 90vh;
}
</style>
